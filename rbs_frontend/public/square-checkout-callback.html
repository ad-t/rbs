<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="shortcut icon" href="favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta
    name="description"
    content="Payment complete"
  />
  <link rel="apple-touch-icon" href="logo192.png" />
  <!--
    Notice the use of %PUBLIC_URL% in the tags above.
    It will be replaced with the URL of the `public` folder during the build.
    Only files inside the `public` folder can be referenced from the HTML.

    Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
    work correctly both with client-side routing and a non-root public URL.
    Learn how to configure a non-root public URL by running `npm run build`.
  -->
  <title>Payment Complete &ndash; Med Revue 2021</title>
<script>
async function main() {
  const params = (new URL(document.location)).searchParams;
  // Reference ID is our own internal order ID (not Square's order ID).
  const orderId = params.get("referenceId");

  // TODO: find way to use .env variables here
  await fetch(
    `http://localhost:8080/orders/${orderId}/square-verify-payment`,
    { method: 'POST' }
  );

  const elem = document.getElementById("can-close");
  if (elem) {
    elem.textContent = "You may now close this window.";
  }

  window.close();
}

main();
</script>
</head>
<body>
  <h2>Payment Complete</h2>
  <p>Now redirecting back to the confirmation page&hellip;</p>
  <p id="can-close"></p>
  <p>If you are still experiencing issues, please contact us at
    <a href="mailto:ticketing@medrevue.org">ticketing@medrevue.org</a>.</p>
</body>
</html>
